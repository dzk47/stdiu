<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A√ßa√≠ Supreme</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .acai-gradient { background: linear-gradient(135deg, #4b0082 0%, #310055 100%); }
        .tab-bar { backdrop-filter: blur(10px); background: rgba(255,255,255,0.8); }
        body { font-family: 'Inter', sans-serif; background: #fdfdfd; }
    </style>
</head>
<body class="pb-24">
    <!-- Header -->
    <header class="acai-gradient p-6 rounded-b-[40px] text-white shadow-2xl">
        <h1 class="text-3xl font-black italic tracking-tighter">A√áA√ç SUPREME</h1>
        <div class="mt-4 flex bg-white/20 p-3 rounded-2xl backdrop-blur-md">
            <input type="text" id="address" placeholder="Endere√ßo de entrega..." class="bg-transparent border-none outline-none w-full text-sm placeholder-purple-200">
            <button onclick="window.getGPS()">üìç</button>
        </div>
    </header>

    <!-- Status de Acompanhamento -->
    <div id="tracking" class="p-4 hidden">
        <div class="bg-purple-100 border-2 border-purple-500 p-4 rounded-3xl flex items-center justify-between">
            <div>
                <p class="text-[10px] font-bold text-purple-600 uppercase">Seu pedido est√°:</p>
                <p id="status-display" class="font-black text-purple-900">Aguardando...</p>
            </div>
            <div class="animate-bounce text-2xl">üçß</div>
        </div>
    </div>

    <!-- Lista de Produtos -->
    <div class="p-4 grid gap-4" id="menu">
        <div onclick="window.openToppings('Copo 500ml', 22.90)" class="bg-white p-4 rounded-[30px] shadow-sm flex items-center gap-4 border border-gray-100">
            <img src="https://images.unsplash.com/photo-1590301157890-4810ed352733?w=150" class="w-20 h-20 rounded-2xl object-cover">
            <div class="flex-1">
                <h3 class="font-bold">Copo Tradicional 500ml</h3>
                <p class="text-xs text-gray-400">Escolha at√© 3 adicionais</p>
                <p class="font-bold text-purple-600 mt-1">R$ 22,90</p>
            </div>
        </div>
    </div>

    <!-- Modal de Adicionais -->
    <div id="modal-toppings" class="fixed inset-0 bg-black/60 hidden flex items-end z-50">
        <div class="bg-white w-full p-6 rounded-t-[40px] animate-slide-up">
            <h2 class="text-xl font-bold mb-4">Escolha os Adicionais (Max 3)</h2>
            <div class="grid grid-cols-2 gap-2 text-sm" id="toppings-options">
                <!-- JS preenche -->
            </div>
            <button onclick="window.addToCart()" class="w-full acai-gradient text-white py-4 rounded-2xl font-bold mt-6 shadow-lg">Adicionar √† Sacola</button>
        </div>
    </div>

    <!-- Carrinho -->
    <div id="cart-btn" class="fixed bottom-6 left-4 right-4 acai-gradient p-4 rounded-3xl hidden flex justify-between items-center text-white shadow-2xl">
        <span id="cart-info" class="font-bold">1 Item | R$ 22,90</span>
        <button onclick="window.confirmarPedido()" class="bg-white text-purple-900 px-6 py-2 rounded-xl font-black">PEDIR AGORA</button>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, set, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyB1DaTOer5_cZ-JT15FlZGapNV1nUDrhmE",
            authDomain: "acai-delibery.firebaseapp.com",
            databaseURL: "https://acai-delibery-default-rtdb.firebaseio.com",
            projectId: "acai-delibery",
            storageBucket: "acai-delibery.firebasestorage.app",
            messagingSenderId: "476733774850",
            appId: "1:476733774850:web:0549e47df6ee8dc2e79b1b"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        window.currentOrder = { item: "", preco: 0, adicionais: [] };
        const toppings = ["Leite Ninho", "Morango", "Banana", "Granola", "Nutella", "Ovomaltine", "Pa√ßoca", "Leite Condensado"];

        window.openToppings = (nome, preco) => {
            window.currentOrder = { item: nome, preco: preco, adicionais: [] };
            const container = document.getElementById('toppings-options');
            container.innerHTML = toppings.map(t => `
                <label class="flex items-center p-3 border rounded-xl gap-2">
                    <input type="checkbox" value="${t}" onchange="window.limitCheck(this)"> ${t}
                </label>
            `).join('');
            document.getElementById('modal-toppings').classList.remove('hidden');
        };

        window.limitCheck = (el) => {
            const checked = document.querySelectorAll('#toppings-options input:checked');
            if (checked.length > 3) { el.checked = false; alert("Limite de 3 itens atingido!"); }
        };

        window.addToCart = () => {
            const checked = Array.from(document.querySelectorAll('#toppings-options input:checked')).map(i => i.value);
            window.currentOrder.adicionais = checked;
            document.getElementById('modal-toppings').classList.add('hidden');
            document.getElementById('cart-btn').classList.remove('hidden');
            document.getElementById('cart-info').innerText = `${window.currentOrder.item} (R$ ${window.currentOrder.preco.toFixed(2)})`;
        };

        window.confirmarPedido = async () => {
            const addr = document.getElementById('address').value;
            if(!addr) return alert("Preencha o endere√ßo!");
            
            const pedido = {
                ...window.currentOrder,
                cliente: addr,
                status: "pendente",
                total: window.currentOrder.preco + 5.0, // + taxa
                data: new Date().toLocaleTimeString(),
                id: Math.floor(Math.random() * 9999)
            };

            const refPedido = push(ref(db, 'pedidos'));
            await set(refPedido, pedido);
            
            document.getElementById('cart-btn').classList.add('hidden');
            document.getElementById('tracking').classList.remove('hidden');
            
            onValue(refPedido, (snap) => {
                const p = snap.val();
                if(p) {
                    const statusText = { pendente: "Aguardando Loja...", preparando: "Preparando seu A√ßa√≠...", entrega: "Saiu para Entrega!", concluido: "Entregue!" };
                    document.getElementById('status-display').innerText = statusText[p.status];
                }
            });
        };
        
        window.getGPS = () => {
            navigator.geolocation.getCurrentPosition(p => {
                document.getElementById('address').value = `GPS: ${p.coords.latitude.toFixed(4)}, ${p.coords.longitude.toFixed(4)}`;
                window.currentCoords = { lat: p.coords.latitude, lon: p.coords.longitude };
            });
        };
    </script>
</body>
</html>
