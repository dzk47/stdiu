<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A√ßa√≠ Delivery - Pedir Agora</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --purple: #4b0082; }
        .btn-purple { background: var(--purple); color: white; }
    </style>
</head>
<body class="bg-gray-100 pb-24">
    <header class="bg-[#4b0082] text-white p-6 text-center rounded-b-3xl shadow-lg">
        <h1 class="text-2xl font-bold italic">A√ßa√≠ Supreme</h1>
        <p class="text-xs opacity-80">O melhor da regi√£o na sua porta</p>
    </header>

    <main class="p-4 max-w-md mx-auto space-y-6">
        <!-- SE√á√ÉO ENDERE√áO -->
        <div class="bg-white p-4 rounded-2xl shadow-sm">
            <h2 class="font-bold mb-3 flex items-center gap-2">üìç Entrega</h2>
            <input type="text" id="address" placeholder="Rua, N√∫mero, Bairro, Cidade" class="w-full border p-3 rounded-xl text-sm mb-2">
            <button onclick="calcDistancia()" class="w-full bg-blue-600 text-white py-2 rounded-xl text-sm font-bold">Calcular Frete</button>
            <div id="taxa-info" class="mt-2 text-sm text-gray-600 hidden"></div>
        </div>

        <!-- CARD√ÅPIO -->
        <h3 class="font-bold text-lg text-purple-900">Escolha seu A√ßa√≠</h3>
        <div id="menu-container" class="space-y-3">
            <!-- JS vai preencher aqui -->
        </div>
    </main>

    <!-- CARRINHO FLUTUANTE -->
    <div id="cart-footer" class="fixed bottom-0 left-0 w-full bg-white p-4 border-t shadow-2xl flex justify-between items-center hidden">
        <div>
            <span class="text-xs text-gray-400">Total + Frete</span>
            <p id="total-price" class="text-xl font-bold text-purple-800">R$ 0,00</p>
        </div>
        <button onclick="finalizarPedido()" class="btn-purple px-8 py-3 rounded-2xl font-bold">Enviar Pedido</button>
    </div>

    <script>
        let settings = JSON.parse(localStorage.getItem('acai_settings')) || { taxaKm: 2.0, storeCoords: {lat: -23.55, lon: -46.63}, phone: "5511999999999" };
        let menu = JSON.parse(localStorage.getItem('acai_menu')) || [{id:1, name:"A√ßa√≠ 500ml", price: 20}];
        let currentSelection = null;
        let deliveryData = { km: 0, taxa: 0, addr: "" };

        function render() {
            const container = document.getElementById('menu-container');
            container.innerHTML = menu.map(item => `
                <div onclick="selectItem(${item.id})" id="item-${item.id}" class="bg-white p-4 rounded-2xl flex justify-between items-center cursor-pointer border-2 border-transparent transition-all">
                    <div><h4 class="font-bold">${item.name}</h4><p class="text-xs text-gray-400">Clique para selecionar</p></div>
                    <span class="font-bold text-purple-600">R$ ${parseFloat(item.price).toFixed(2)}</span>
                </div>
            `).join('');
        }

        async function calcDistancia() {
            const addr = document.getElementById('address').value;
            if(!addr) return alert("Digite o endere√ßo!");
            
            // Simula√ß√£o de busca de coordenadas (Geocoding)
            const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(addr)}`);
            const data = await res.json();
            if(!data[0]) return alert("Endere√ßo n√£o localizado!");

            const lat = data[0].lat; const lon = data[0].lon;
            // C√°lculo simplificado de dist√¢ncia (Haversine/Linha reta para este exemplo)
            const dist = Math.sqrt(Math.pow(lat - settings.storeCoords.lat, 2) + Math.pow(lon - settings.storeCoords.lon, 2)) * 111; // aprox km
            
            deliveryData.km = dist.toFixed(1);
            deliveryData.taxa = dist * settings.taxaKm;
            deliveryData.addr = addr;

            const info = document.getElementById('taxa-info');
            info.innerHTML = `üõµ Dist√¢ncia: ${deliveryData.km}km | Taxa: <b>R$ ${deliveryData.taxa.toFixed(2)}</b>`;
            info.classList.remove('hidden');
            updateTotal();
        }

        function selectItem(id) {
            currentSelection = menu.find(i => i.id === id);
            document.querySelectorAll('#menu-container > div').forEach(d => d.style.borderColor = 'transparent');
            document.getElementById(`item-${id}`).style.borderColor = '#4b0082';
            document.getElementById('cart-footer').classList.remove('hidden');
            updateTotal();
        }

        function updateTotal() {
            if(!currentSelection) return;
            const total = parseFloat(currentSelection.price) + deliveryData.taxa;
            document.getElementById('total-price').innerText = `R$ ${total.toFixed(2)}`;
        }

        function finalizarPedido() {
            if(!deliveryData.addr) return alert("Calcule o frete primeiro!");
            
            const pedido = {
                id: Math.floor(Math.random() * 9999),
                cliente: deliveryData.addr,
                item: currentSelection.name,
                total: (parseFloat(currentSelection.price) + deliveryData.taxa).toFixed(2),
                taxa: deliveryData.taxa.toFixed(2),
                status: 'Pendente'
            };

            // Salva para o Motoboy ver
            let pedidos = JSON.parse(localStorage.getItem('pedidos_fila')) || [];
            pedidos.push(pedido);
            localStorage.setItem('pedidos_fila', JSON.stringify(pedidos));

            // Envia WhatsApp
            const msg = `*NOVO PEDIDO*%0A*Item:* ${pedido.item}%0A*Endere√ßo:* ${pedido.cliente}%0A*Taxa:* R$ ${pedido.taxa}%0A*Total:* R$ ${pedido.total}`;
            window.open(`https://wa.me/${settings.phone}?text=${msg}`);
            alert("Pedido enviado!");
        }

        render();
    </script>
</body>
</html>
