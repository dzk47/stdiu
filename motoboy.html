<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getDatabase, ref, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

  const firebaseConfig = { /* COLE O SEU CONFIG AQUI NOVAMENTE */ };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // OUVIR PEDIDOS EM TEMPO REAL
  const pedidosRef = ref(db, 'pedidos');
  onValue(pedidosRef, (snapshot) => {
    const pedidos = snapshot.val();
    const container = document.getElementById('lista-entregas');
    container.innerHTML = ""; // Limpa a lista antes de atualizar

    if (!pedidos) {
      container.innerHTML = "<p class='text-center'>Nenhuma entrega agora.</p>";
      return;
    }

    // Toca um som de alerta se quiser
    // new Audio('alerta.mp3').play();

    for (let id in pedidos) {
      const p = pedidos[id];
      container.innerHTML += `
        <div class="bg-slate-800 p-4 rounded-2xl mb-4 border-l-4 border-yellow-500">
           <p class="font-bold text-lg">${p.item}</p>
           <p class="text-sm text-slate-300">ğŸ“ ${p.cliente}</p>
           <div class="flex gap-2 mt-4">
              <a href="https://www.google.com/maps/search/?api=1&query=${p.coords.lat},${p.coords.lon}" 
                 target="_blank" class="flex-1 bg-blue-600 py-2 rounded-lg text-center font-bold">ğŸ—ºï¸ Ver Mapa</a>
              <button onclick="marcarEntregue('${id}')" class="flex-1 bg-green-600 py-2 rounded-lg font-bold">âœ… Entregue</button>
           </div>
        </div>
      `;
    }
  });

  // FunÃ§Ã£o para deletar o pedido quando o motoboy entregar
  window.marcarEntregue = (id) => {
    if(confirm("Confirmar entrega?")) {
      remove(ref(db, `pedidos/${id}`));
    }
  };
</script>
